/**
 * 统一内容样式系统
 * 用于文章展示和编辑器，确保 WYSIWYG 一致性
 */

/* 隐藏滚动条 */
.scrollbar-hide {
  -ms-overflow-style: none;
  scrollbar-width: none;
}

.scrollbar-hide::-webkit-scrollbar {
  display: none;
}

/* ============================================
   基础内容样式
   ============================================ */
.content-body {
  @apply font-sans text-foreground max-w-none;
  --content-primary: #42b983;
  --content-quote-bg: hsl(var(--muted) / 0.3);
  --content-code-bg: #282c34;

  /* 可控排版变量（由 leading/spacing 变体类覆盖）*/
  /* 默认值 = compact 间距 + normal 行高 */
  --content-line-height: 1.6;
  --content-p-mb: 0.75rem;
  --content-h1-mt: 2rem;
  --content-h1-mb: 1rem;
  --content-h2-mt: 1.5rem;
  --content-h2-mb: 0.75rem;
  --content-h3-mt: 1.25rem;
  --content-h3-mb: 0.5rem;
  --content-img-my: 1rem;

  /* heti 理念：CJK 字间距提升可读性 */
  letter-spacing: 0.02em;
  overflow-wrap: break-word;
  word-wrap: break-word;
}

/* 英文/代码/链接恢复正常字间距（参考 heti） */
.content-body a,
.content-body code,
.content-body kbd,
.content-body samp {
  letter-spacing: normal;
}

/* 首尾元素去除多余 margin（参考 heti） */
.content-body > *:first-child {
  margin-top: 0 !important;
}

.content-body > *:last-child {
  margin-bottom: 0 !important;
}

/* 连续标题间距折叠（参考 heti） */
.content-body h1 + h2,
.content-body h2 + h3,
.content-body h3 + h4,
.content-body h4 + h5,
.content-body h5 + h6 {
  margin-top: 1rem;
}

/* 字体大小变体 */
.content-text-xs {
  @apply text-xs leading-5;
}

.content-text-sm {
  @apply text-sm leading-6;
}

.content-text-base {
  @apply text-base leading-7;
}

.content-text-lg {
  @apply text-lg leading-8;
}

/* 行高/间距变体 → 见文件末尾（需在主题定义之后，利用 CSS 级联覆盖） */

/* ============================================
   标题样式 - 优化间距和层级
   使用 em 单位，随 content-text-* 字体大小变体自动缩放
   采用 mobile-first：基础 = 移动端字号，桌面端通过媒体查询放大
   ============================================ */
.content-body h1 {
  @apply font-bold;
  font-size: 1.5em;
  margin-top: var(--content-h1-mt);
  margin-bottom: var(--content-h1-mb);
  color: var(--foreground);
  line-height: 1.2;
  letter-spacing: 0.05em; /* CJK 标题宽字距（参考 heti） */
}

.content-body h2 {
  @apply font-bold;
  font-size: 1.25em;
  margin-top: var(--content-h2-mt);
  margin-bottom: var(--content-h2-mb);
  color: var(--foreground);
  line-height: 1.25;
  letter-spacing: 0.05em;
}

.content-body h3 {
  @apply font-semibold pl-3 border-l-4;
  font-size: 1.125em;
  margin-top: var(--content-h3-mt);
  margin-bottom: var(--content-h3-mb);
  border-color: var(--content-primary);
  color: var(--foreground);
  line-height: 1.3;
  letter-spacing: 0.05em;
}

.content-body h4 {
  @apply font-semibold;
  font-size: 1.125em;
  margin-top: 1.5rem;
  margin-bottom: 0.75rem;
  color: var(--foreground);
}

.content-body h5 {
  @apply font-semibold;
  font-size: 1em;
  margin-top: 1.25rem;
  margin-bottom: 0.5rem;
  color: var(--foreground);
}

.content-body h6 {
  @apply font-semibold uppercase tracking-wide;
  font-size: 0.875em;
  margin-top: 1rem;
  margin-bottom: 0.5rem;
  color: var(--muted-foreground);
}

/* 桌面端标题放大 */
@media (min-width: 768px) {
  .content-body h1 { font-size: 2.25em; }
  .content-body h2 { font-size: 1.875em; }
  .content-body h3 { font-size: 1.5em; }
  .content-body h4 { font-size: 1.25em; }
  .content-body h5 { font-size: 1.125em; }
}

/* ============================================
   段落和文本 - 优化间距和可读性
   ============================================ */
.content-body p {
  margin-bottom: var(--content-p-mb);
  letter-spacing: 0.02em;
  line-height: var(--content-line-height);
  text-align: justify; /* CJK 两端对齐（参考 heti） */
}

.content-body strong {
  @apply font-semibold;
}

/* em 恢复浏览器默认斜体 */
.content-body em {
  @apply italic;
}

.content-body del {
  @apply text-muted-foreground line-through;
  text-decoration-thickness: 2px;
}

/* ============================================
   链接
   ============================================ */
.content-body a {
  @apply no-underline font-medium transition-opacity;
  color: var(--content-primary);
  border-bottom: 1px solid var(--content-primary);
}

.content-body a:hover {
  @apply opacity-75;
}

/* ============================================
   引用块
   ============================================ */
.content-body blockquote {
  @apply my-5 pl-4 py-3 rounded-r-lg border-l-4 not-italic;
  background-color: var(--content-quote-bg);
  border-color: var(--content-primary);
  color: var(--muted-foreground);
}

.content-body blockquote p {
  @apply m-0;
}

/* ============================================
   列表 - 优化间距和可读性
   ============================================ */
.content-body ul {
  @apply list-disc pl-6 mb-5; /* 增加底部间距 */
}

.content-body ol {
  @apply list-decimal pl-6 mb-5; /* 增加底部间距 */
}

.content-body li {
  @apply mb-2 pl-1;
  line-height: var(--content-line-height);
}

/* 嵌套列表 */
.content-body ul ul,
.content-body ol ul,
.content-body ul ol,
.content-body ol ol {
  @apply mt-2 mb-0;
}

/* ============================================
   任务列表 (Tiptap)
   ============================================ */
.content-body ul[data-type="taskList"] {
  @apply list-none pl-0 my-4;
}

/* TaskItem: checkbox 和文字同行 */
.content-body ul[data-type="taskList"] li.task-item,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

/* label 只包含 checkbox */
.content-body ul[data-type="taskList"] .task-item-label,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] > label {
  display: flex;
  align-items: center;
  flex-shrink: 0;
  margin-top: 2px;
  cursor: pointer;
}

/* 内容区域 - span 或 div */
.content-body ul[data-type="taskList"] .task-item-content,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] > div,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] > span {
  flex: 1;
  min-width: 0;
}

/* 内容区域的段落去掉 margin */
.content-body ul[data-type="taskList"] .task-item-content > p,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] > div > p,
.content-body ul[data-type="taskList"] li[data-type="taskItem"] > span > p {
  margin: 0;
  display: inline;
}

/* 嵌套任务列表 */
.content-body ul[data-type="taskList"] ul[data-type="taskList"] {
  @apply pl-6 mt-2 mb-0;
}

/* Checkbox */
.content-body ul[data-type="taskList"] input[type="checkbox"] {
  width: 16px;
  height: 16px;
  margin: 0;
  cursor: pointer;
  accent-color: var(--content-primary);
}

/* 已完成任务 */
.content-body li[data-checked="true"] .task-item-content,
.content-body li[data-checked="true"] > div,
.content-body li[data-checked="true"] > span {
  text-decoration: line-through;
  color: var(--muted-foreground);
}

/* ============================================
   任务列表 (GFM/MarkdownRenderer)
   ============================================ */
.content-body ul.contains-task-list {
  @apply list-none pl-0 my-4;
}

.content-body li.task-list-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

.content-body li.task-list-item > input[type="checkbox"] {
  margin-top: 4px;
  flex-shrink: 0;
}

.content-body ul.contains-task-list ul.contains-task-list {
  @apply pl-6 mt-1 mb-0;
}

/* ============================================
   代码 - 增强视觉分离
   ============================================ */
/* 行内代码 */
.content-body code:not(pre code) {
  @apply px-1.5 py-0.5 mx-0.5 rounded text-sm font-mono;
  color: #c7254e;
  background-color: #f9f2f4;
  word-break: break-word;
  overflow-wrap: break-word;
  border: 1px solid rgba(199, 37, 78, 0.1); /* 添加细边框 */
}

.dark .content-body code:not(pre code) {
  color: #ff6b6b;
  background-color: #2c2c2c;
  border: 1px solid rgba(255, 107, 107, 0.2);
}

/* 代码块 */
.content-body pre {
  @apply relative rounded-lg overflow-auto my-6 p-4 border bg-transparent;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1); /* 添加阴影增强分离 */
}

.content-body pre code {
  @apply block overflow-x-auto text-sm font-mono bg-transparent;
  color: inherit;
  line-height: 1.6; /* 代码行高优化 */
}

/* ============================================
   图片 - 优化间距和视觉效果
   ============================================ */
.content-body img {
  @apply block mx-auto rounded-lg max-w-full h-auto border border-border;
  margin-top: var(--content-img-my);
  margin-bottom: var(--content-img-my);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05); /* 添加轻微阴影 */
  display: block !important; /* 强制块级显示 */
}

/* 编辑器中的图片样式 */
.content-editor img {
  @apply block mx-auto rounded-lg my-4 max-w-full h-auto border border-border;
  display: block !important; /* 强制块级显示 */
}

/* 确保图片所在的段落也是块级 - 但排除表格单元格内的段落 */
.content-editor p:has(img):not(td p):not(th p),
.content-body p:has(img):not(td p):not(th p) {
  @apply block w-full;
  display: block !important;
}

/* 图片前后强制换行 */
.content-editor img::before,
.content-editor img::after,
.content-body img::before,
.content-body img::after {
  content: "";
  display: block;
  width: 100%;
  height: 0;
}

/* 更强制的图片块级显示 - 默认独占一行 */
.content-editor .ProseMirror img,
.content-body img {
  display: block !important;
  clear: both !important;
  float: none !important;
  margin-left: auto !important;
  margin-right: auto !important;
}

/* 确保包含图片的元素也是块级 - 但排除表格单元格 */
.content-editor .ProseMirror *:has(img):not(td):not(th),
.content-body *:has(img):not(td):not(th) {
  width: 100% !important;
  /* display: block !important; */
}

/* 图片节点强制独占一行 */
.content-editor .ProseMirror [data-type="image"],
.content-body [data-type="image"] {
  display: block !important;
  width: 100% !important;
  margin: 1rem 0 !important;
}

/* 图片对齐样式 - 不使用浮动，避免图文混排 */

/* 左对齐 - 图片独占一行但左对齐 */
.content-body img[data-align="left"],
.content-editor img[data-align="left"] {
  margin-left: 0 !important;
  margin-right: auto !important;
  display: block !important;
  float: none !important;
}

/* 右对齐 - 图片独占一行但右对齐 */
.content-body img[data-align="right"],
.content-editor img[data-align="right"] {
  margin-left: auto !important;
  margin-right: 0 !important;
  display: block !important;
  float: none !important;
}

/* 居中对齐 - 默认就是居中 */
.content-body img[data-align="center"],
.content-editor img[data-align="center"] {
  margin-left: auto !important;
  margin-right: auto !important;
  display: block !important;
  float: none !important;
}

/* 传统的段落对齐样式支持 - 不使用浮动 */
.content-body p.text-left img,
.content-editor p.text-left img {
  margin-left: 0 !important;
  margin-right: auto !important;
  float: none !important;
  display: block !important;
}

.content-body p.text-center img,
.content-editor p.text-center img {
  margin-left: auto !important;
  margin-right: auto !important;
  float: none !important;
  display: block !important;
}

.content-body p.text-right img,
.content-editor p.text-right img {
  margin-left: auto !important;
  margin-right: 0 !important;
  float: none !important;
  display: block !important;
}

/* 图片说明样式 */
.content-body .image-caption {
  @apply text-sm text-muted-foreground text-center mt-2 mb-4 italic;
}

/* ============================================
   分割线
   ============================================ */
.content-body hr {
  @apply my-8 border-none h-px;
  background-image: linear-gradient(
    to right,
    transparent,
    hsl(var(--border)),
    transparent
  );
}

/* ============================================
   表格 - 简洁样式
   ============================================ */

/* 表格容器：仅负责溢出滚动 */
.content-body .table-wrapper,
.content-body .tableWrapper,
.content-body > div:has(> table) {
  @apply overflow-x-auto my-6;
}

/* 表格本身 */
.content-body table {
  @apply text-sm;
  border-collapse: collapse;
  border-spacing: 0;
  table-layout: fixed;
  width: auto;
  margin: 0 auto;
}

/* 单元格 */
.content-body th,
.content-body td {
  @apply px-4 py-3 text-center align-middle;
  border: 1px solid hsl(var(--border) / 0.5);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

/* 表头 */
.content-body th {
  @apply font-medium text-foreground;
  background-color: hsl(var(--muted) / 0.6);
}

.dark .content-body th {
  background-color: hsl(var(--muted) / 0.35);
}

/* 单元格内段落 */
.content-body td p,
.content-body th p {
  margin: 0;
  padding: 0;
  display: inline;
  line-height: 1.5;
}

/* 脚注引用在表格中 */
.content-body .tableWrapper .footnote-ref {
  @apply text-primary hover:underline cursor-pointer;
  font-size: 0.75em;
  vertical-align: super;
  display: inline;
}

/* 隐藏 ProseMirror 内部元素 */
.content-body .ProseMirror-separator,
.content-body .ProseMirror-trailingBreak {
  display: none !important;
}

/* colgroup 最小宽度 */
.content-body .tableWrapper colgroup col {
  min-width: 80px;
}

/* ============================================
   表格列宽调整 (Tiptap resizable)
   ============================================ */
/* 列宽调整手柄 */
.content-editor .tableWrapper {
  @apply overflow-x-auto my-6;
}

.content-editor table {
  @apply text-sm;
  border-collapse: collapse;
  border-spacing: 0;
  border: none !important; /* 移除表格外边框 */
  table-layout: fixed; /* 固定布局 */
  width: auto;
  margin: 0 auto;
  overflow: hidden;
}

.content-editor th,
.content-editor td {
  @apply px-4 py-3 text-center align-middle; /* 居中对齐 */
  border: 1px solid hsl(var(--border) / 0.5); /* 保留单元格内部边框 */
  position: relative;
  box-sizing: border-box;
  width: 120px; /* 固定宽度 */
  height: 50px; /* 固定高度 */
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
  vertical-align: middle; /* 垂直居中 */
}

.content-editor th {
  @apply font-medium text-foreground;
  background-color: hsl(var(--muted) / 0.6);
}

.dark .content-editor th {
  background-color: hsl(var(--muted) / 0.35);
}

.content-editor td {
  @apply text-foreground;
}

/* 列宽调整手柄样式 */
.content-editor .column-resize-handle {
  position: absolute;
  right: -2px;
  top: 0;
  bottom: -2px;
  width: 4px;
  background-color: hsl(var(--primary));
  pointer-events: none;
  z-index: 20;
}

/* 调整时的视觉反馈 */
.content-editor .resize-cursor {
  cursor: col-resize;
}

/* 选中的单元格 */
.content-editor .selectedCell:after {
  z-index: 2;
  position: absolute;
  content: "";
  left: 0;
  right: 0;
  top: 0;
  bottom: 0;
  background: hsl(var(--primary) / 0.1);
  pointer-events: none;
}

/* 表格选中状态 */
.content-editor table.ProseMirror-selectednode {
  outline: 2px solid hsl(var(--primary));
  outline-offset: 2px;
}

/* ============================================
   折叠面板
   ============================================ */
.content-body details {
  @apply my-4 rounded-lg border border-border overflow-hidden;
  background-color: var(--content-quote-bg);
}

.content-body summary {
  @apply cursor-pointer px-4 py-3 font-medium select-none transition-colors;
}

.content-body summary:hover {
  @apply bg-muted/50;
}

.content-body details[open] summary {
  @apply border-b border-border;
}

/* details 内容区域 */
.content-body details > *:not(summary) {
  @apply px-4;
}

.content-body details > *:not(summary):first-of-type {
  @apply pt-3;
}

.content-body details > *:not(summary):last-child {
  @apply pb-3;
}

/* details 内部列表样式 */
.content-body details ul {
  @apply list-disc pl-6 mb-4;
}

.content-body details ol {
  @apply list-decimal pl-6 mb-4;
}

.content-body details li {
  @apply mb-2 pl-1;
  line-height: 1.7;
}

/* details 内部嵌套列表 */
.content-body details ul ul,
.content-body details ol ul,
.content-body details ul ol,
.content-body details ol ol {
  @apply mt-2 mb-0;
}

/* details 内部任务列表 */
.content-body details ul[data-type="taskList"] {
  @apply list-none pl-0 my-4;
}

.content-body details ul[data-type="taskList"] li {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

.content-body details ul.contains-task-list {
  @apply list-none pl-0 my-4;
}

.content-body details li.task-list-item {
  display: flex;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.25rem;
}

/* details 内部代码块 */
.content-body details pre {
  @apply relative rounded-lg overflow-auto my-4 p-4 border bg-transparent;
}

/* details 内部引用 */
.content-body details blockquote {
  @apply my-4 pl-4 py-3 rounded-r-lg border-l-4 not-italic;
  background-color: hsl(var(--muted) / 0.5);
  border-color: var(--content-primary);
  color: var(--muted-foreground);
}

/* details 内部标题 */
.content-body details h1,
.content-body details h2,
.content-body details h3,
.content-body details h4,
.content-body details h5,
.content-body details h6 {
  @apply mt-4 first:mt-0;
}

/* details 内部图片 */
.content-body details img {
  @apply block mx-auto rounded-lg my-4 max-w-full h-auto border border-border;
}

/* details 内部分割线 */
.content-body details hr {
  @apply my-4 border-none h-px;
  background-image: linear-gradient(
    to right,
    transparent,
    hsl(var(--border)),
    transparent
  );
}

/* ============================================
   高亮和标记
   ============================================ */
.content-body mark {
  @apply px-1 rounded;
  background-color: #fef08a;
}

.dark .content-body mark {
  background-color: rgba(234, 179, 8, 0.3);
}

/* ============================================
   上下标
   ============================================ */
.content-body sub {
  @apply text-xs;
  vertical-align: sub;
}

.content-body sup {
  @apply text-xs;
  vertical-align: super;
}

/* ============================================
   脚注
   ============================================ */
.content-body .footnotes {
  @apply mt-12 pt-6 border-t text-sm;
  border-color: hsl(var(--border));
}

.content-body .footnotes-title {
  @apply text-lg font-bold mb-4 mt-0;
  color: var(--foreground);
}

.content-body .footnotes-list {
  @apply list-decimal pl-6 space-y-2;
  counter-reset: footnote-counter;
}

.content-body .footnote-item {
  @apply pl-2;
  line-height: 1.6;
}

.content-body .footnote-content {
  @apply inline;
}

.content-body .footnote-ref {
  @apply text-xs align-super font-normal;
  color: var(--content-primary);
  text-decoration: none;
  border-bottom: none;
}

.content-body .footnote-ref a {
  color: var(--content-primary);
  text-decoration: none;
  border-bottom: none;
}

.content-body .footnote-ref a:hover {
  text-decoration: underline;
}

.content-body .footnote-backref {
  @apply ml-1 text-xs no-underline;
  color: var(--content-primary);
}

.content-body .footnote-backref:hover {
  text-decoration: underline;
}

/* 脚注高亮效果 */
.content-body .footnote-item:target,
.content-body .footnote-item.footnote-highlight {
  @apply bg-primary/10 -mx-2 px-2 py-1 rounded;
  animation: footnote-highlight 2s ease-out;
}

.content-body .footnote-ref.footnote-highlight {
  @apply bg-primary/20 rounded px-0.5;
  animation: footnote-highlight 2s ease-out;
}

@keyframes footnote-highlight {
  0% {
    background-color: hsl(var(--primary) / 0.3);
  }
  100% {
    background-color: hsl(var(--primary) / 0.1);
  }
}

/* ============================================
   Mermaid 图表
   ============================================ */
.content-body .mermaid,
.content-body .mermaid-wrapper {
  @apply my-6 p-4 rounded-lg;
  background: hsl(var(--muted) / 0.3);
  overflow-x: auto;
  overflow-y: visible;
  -webkit-overflow-scrolling: touch;
}

.content-body .mermaid svg,
.content-body .mermaid-render svg,
.content-body .mermaid-wrapper svg {
  @apply mx-auto;
  background: transparent !important;
  max-width: 100%;
  height: auto;
}

/* --- Mermaid foreignObject 内 HTML 元素布局修正 ---
   Mermaid 在 foreignObject 内放置 div > span > p 来渲染标签文字。
   foreignObject 的宽高由 Mermaid 精确计算，非常紧凑（例如 28×21px）。
   浏览器默认 <p> margin-top/bottom: 1em 会把文字推出可视区域！
   这个规则对亮色/暗色模式都必需 */
.mermaid svg foreignObject p,
.mermaid-wrapper svg foreignObject p,
.content-body .mermaid svg foreignObject p,
.content-body .mermaid-wrapper svg foreignObject p {
  margin: 0 !important;
  padding: 0 !important;
}

/* foreignObject 内的 span/div 也重置 padding */
.mermaid svg foreignObject .edgeLabel,
.mermaid svg foreignObject .nodeLabel,
.mermaid-wrapper svg foreignObject .edgeLabel,
.mermaid-wrapper svg foreignObject .nodeLabel,
.content-body .mermaid svg foreignObject .edgeLabel,
.content-body .mermaid svg foreignObject .nodeLabel {
  padding: 0 !important;
  margin: 0 !important;
}

/* 移动端 Mermaid 优化 — 等比例缩放适应屏幕 */
@media (max-width: 768px) {
  .content-body .mermaid,
  .content-body .mermaid-wrapper {
    padding: 0.5rem;
    overflow: hidden;
  }

  /* SVG 移动端整体缩小，保持协调 */
  .content-body .mermaid svg,
  .content-body .mermaid-render svg,
  .content-body .mermaid-wrapper svg {
    width: auto !important;
    max-width: 75% !important;
    height: auto !important;
    margin: 0 auto;
  }
}

/* 暗黑模式下 Mermaid 文字颜色优化 */

/* --- 基础: SVG text / tspan 元素 --- */
:root.dark .content-body .mermaid svg text,
:root.dark .content-body .mermaid-wrapper svg text,
:root.dark .mermaid svg text,
:root.dark .mermaid-wrapper svg text,
:root.dark .content-body .mermaid svg tspan,
:root.dark .content-body .mermaid-wrapper svg tspan,
:root.dark .mermaid svg tspan,
:root.dark .mermaid-wrapper svg tspan {
  fill: #f8fafc !important;
  color: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- foreignObject 内的 HTML 元素 ---
   Mermaid 流程图用 foreignObject + div.labelBkg > span.edgeLabel > p 渲染节点/边文字
   必须穿透覆盖所有 HTML 子元素的 color 属性 */
:root.dark .mermaid svg foreignObject,
:root.dark .mermaid svg foreignObject *,
:root.dark .mermaid-wrapper svg foreignObject,
:root.dark .mermaid-wrapper svg foreignObject *,
:root.dark .content-body .mermaid svg foreignObject,
:root.dark .content-body .mermaid svg foreignObject *,
:root.dark .content-body .mermaid-wrapper svg foreignObject,
:root.dark .content-body .mermaid-wrapper svg foreignObject * {
  color: #f8fafc !important;
  fill: #f8fafc !important;
}

/* --- 流程图: 节点标签 (.nodeLabel) --- */
:root.dark .content-body .mermaid svg .nodeLabel,
:root.dark .content-body .mermaid-wrapper svg .nodeLabel,
:root.dark .mermaid svg .nodeLabel,
:root.dark .mermaid-wrapper svg .nodeLabel {
  color: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 流程图: 边标签 (.edgeLabel) 及其内部元素 --- */
:root.dark .content-body .mermaid svg .edgeLabel,
:root.dark .content-body .mermaid-wrapper svg .edgeLabel,
:root.dark .mermaid svg .edgeLabel,
:root.dark .mermaid-wrapper svg .edgeLabel {
  background-color: #1e293b !important;
  color: #f8fafc !important;
  font-weight: 500 !important;
}

:root.dark .mermaid svg .edgeLabel span,
:root.dark .mermaid svg .edgeLabel p,
:root.dark .mermaid svg .labelBkg,
:root.dark .mermaid svg .labelBkg span,
:root.dark .mermaid svg .labelBkg p,
:root.dark .mermaid-wrapper svg .edgeLabel span,
:root.dark .mermaid-wrapper svg .edgeLabel p,
:root.dark .mermaid-wrapper svg .labelBkg,
:root.dark .mermaid-wrapper svg .labelBkg span,
:root.dark .mermaid-wrapper svg .labelBkg p,
:root.dark .content-body .mermaid svg .edgeLabel span,
:root.dark .content-body .mermaid svg .edgeLabel p,
:root.dark .content-body .mermaid svg .labelBkg,
:root.dark .content-body .mermaid svg .labelBkg span,
:root.dark .content-body .mermaid svg .labelBkg p {
  color: #f8fafc !important;
  background-color: transparent !important;
  font-weight: 500 !important;
}

/* --- 通用 .label 类 --- */
:root.dark .content-body .mermaid svg .label,
:root.dark .content-body .mermaid-wrapper svg .label,
:root.dark .mermaid svg .label,
:root.dark .mermaid-wrapper svg .label {
  color: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 流程图标签 --- */
:root.dark .content-body .mermaid svg .flowchart-label,
:root.dark .mermaid svg .flowchart-label {
  color: #f8fafc !important;
  font-weight: 500 !important;
  font-size: 14px !important;
}

/* --- 决策节点文字 --- */
:root.dark .content-body .mermaid svg .decision-text,
:root.dark .mermaid svg .decision-text {
  fill: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 流程图节点内文字 --- */
:root.dark .content-body .mermaid svg .node text,
:root.dark .mermaid svg .node text {
  fill: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 子图标题 (.cluster-label) --- */
:root.dark .mermaid svg .cluster-label text,
:root.dark .mermaid svg .cluster-label span,
:root.dark .mermaid-wrapper svg .cluster-label text,
:root.dark .mermaid-wrapper svg .cluster-label span,
:root.dark .content-body .mermaid svg .cluster-label text,
:root.dark .content-body .mermaid svg .cluster-label span {
  fill: #f8fafc !important;
  color: #f8fafc !important;
  font-weight: 600 !important;
}

/* --- 时序图: 消息文字 / 参与者文字 --- */
:root.dark .mermaid svg .messageText,
:root.dark .mermaid svg .actor text,
:root.dark .mermaid svg .sequenceNumber,
:root.dark .mermaid-wrapper svg .messageText,
:root.dark .mermaid-wrapper svg .actor text,
:root.dark .content-body .mermaid svg .messageText,
:root.dark .content-body .mermaid svg .actor text {
  fill: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 循环/条件标签 --- */
:root.dark .mermaid svg .loopText,
:root.dark .mermaid svg .loopText tspan,
:root.dark .mermaid svg .labelText,
:root.dark .mermaid svg .labelText tspan,
:root.dark .mermaid-wrapper svg .loopText,
:root.dark .mermaid-wrapper svg .labelText,
:root.dark .content-body .mermaid svg .loopText,
:root.dark .content-body .mermaid svg .labelText {
  fill: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 标题文字 (.titleText) --- */
:root.dark .mermaid svg .titleText,
:root.dark .mermaid-wrapper svg .titleText,
:root.dark .content-body .mermaid svg .titleText {
  fill: #f8fafc !important;
  font-weight: 600 !important;
}

/* --- 甘特图 / 饼图 / 类图 / ER 图 --- */
:root.dark .mermaid svg .sectionTitle,
:root.dark .mermaid svg .taskText,
:root.dark .mermaid svg .taskTextOutsideRight,
:root.dark .mermaid svg .taskTextOutsideLeft,
:root.dark .mermaid svg .classText,
:root.dark .mermaid svg .relationshipLabel,
:root.dark .mermaid svg .entityLabel,
:root.dark .mermaid svg .pieLabel,
:root.dark .mermaid svg .legend text {
  fill: #f8fafc !important;
  color: #f8fafc !important;
  font-weight: 500 !important;
}

/* --- 节点边框对比度 --- */
:root.dark .mermaid svg .node rect,
:root.dark .mermaid svg .node circle,
:root.dark .mermaid svg .node polygon,
:root.dark .mermaid-wrapper svg .node rect,
:root.dark .mermaid-wrapper svg .node circle,
:root.dark .mermaid-wrapper svg .node polygon {
  stroke: #60a5fa !important;
}

/* ============================================
   LaTeX 公式
   ============================================ */
/* 行内公式 */
.content-body .math-inline,
.content-body span[data-type="math-inline"] {
  @apply inline-block mx-0.5;
  vertical-align: baseline;
}

/* 块级公式 */
.content-body .math-block,
.content-body div[data-type="math-block"] {
  line-height: normal;
  display: block;
  width: 100%;

  /* 横向允许滚动，纵向不裁切 */
  overflow-x: auto;
  overflow-y: visible;

  /* 为公式编号(.tag)留出右侧空间，防止重叠 */
  position: relative;
  padding: 1rem 4rem 1rem 1rem;

  @apply my-6 text-center rounded-lg;
  background: hsl(var(--muted) / 0.3);
  -webkit-overflow-scrolling: touch;
}

/* KaTeX display 容器 */
.content-body .math-block .katex-display {
  display: block;
  margin: 0;
  padding: 0;
  width: auto;
  overflow-y: visible;
}

/* 公式保持原始宽度不换行 */
.content-body .math-block .katex {
  white-space: nowrap;
  font-size: 1.05em;
  line-height: normal;
}

/* 修复 vlist 结构重叠 */
.content-body .math-block .vlist-t {
  border-collapse: separate;
}

/* 容器至少和内部内容一样宽，移除 position:relative 让 .tag 定位到 .math-block */
.content-body .math-block .katex-html {
  display: inline-block;
  min-width: min-content;
  position: static;
}

/* 公式编号(.tag)定位修正 — 固定在容器右侧，不随公式滚动 */
.content-body .math-block .tag {
  position: absolute !important;
  right: 0.5rem !important;
  top: 50% !important;
  transform: translateY(-50%) !important;
  display: block !important;
  margin-left: 0 !important;
  float: none !important;
}

/* KaTeX 样式覆盖 - 行内公式 */
.content-body .katex {
  font-size: 1.1em;
  line-height: 1.2;
}

/* 移动端公式优化 — 横向滚动，不缩放 */
@media (max-width: 768px) {
  /* 行内公式：保持 inline，不缩放 */
  .content-body .math-inline,
  .content-body span[data-type="math-inline"] {
    display: inline-block;
    max-width: 100%;
    vertical-align: middle;
    overflow-x: auto;
    overflow-y: visible;
  }

  /* 块级公式容器：允许横向滚动，移动端不需要 padding-right（tag 改为行内） */
  .content-body .math-block,
  .content-body div[data-type="math-block"] {
    overflow-x: auto;
    overflow-y: visible;
    padding: 0.75rem;
    -webkit-overflow-scrolling: touch;
  }

  /* 块级公式内容保持自然宽度 */
  .content-body .math-block .katex-display {
    overflow: visible;
    text-align: center;
    margin: 0;
  }

  /* 公式编号在移动端改为行内跟随（覆盖桌面端的 absolute 定位） */
  .content-body .math-block .tag {
    position: static !important;
    display: inline-block !important;
    margin-left: 1em !important;
    vertical-align: middle !important;
    float: none !important;
    transform: none !important;
    right: auto !important;
    top: auto !important;
  }

  /* 矩阵列间距略微收窄 */
  .content-body .katex .arraycolsep {
    width: 0.3em;
  }
}

/* ============================================
   编辑器特定样式
   ============================================ */
.content-editor {
  @apply min-h-[600px] focus:outline-none pb-24; /* 增加最小高度 */
}

/* 编辑器中的数学块 */
@media (max-width: 768px) {
  .content-editor .math-block-wrapper {
    position: relative;
    margin: 1rem 0;
    clear: both;
  }

  .content-editor .math-preview {
    overflow-x: auto;
    overflow-y: visible;
    position: relative;
  }

  /* 编辑器中公式编号改为行内 */
  .content-editor .katex .tag,
  .content-editor .katex .eqn-num,
  .content-editor .katex-display .tag,
  .content-editor .katex-display .eqn-num {
    position: static;
    display: inline-block;
    margin-left: 0.5em;
    vertical-align: middle;
  }
}

/* Tiptap placeholder */
.content-editor .is-editor-empty:first-child::before {
  @apply text-muted-foreground pointer-events-none float-left h-0;
  content: attr(data-placeholder);
}

/* Tiptap 选中状态 */
.content-editor .ProseMirror-selectednode {
  @apply outline-2 outline-primary outline-offset-2;
}

/* ============================================
   响应式优化 - 移动端适配
   ============================================ */
@media (max-width: 768px) {
  /* 防止页面出现任何滚动条 */
  body {
    overflow-x: hidden;
  }

  .content-body {
    overflow: hidden;
    max-width: 100vw;
    box-sizing: border-box;

    /* 移动端缩小默认间距（可被 spacing 变体覆盖） */
    --content-h1-mt: 2rem;
    --content-h1-mb: 1rem;
    --content-h2-mt: 1.5rem;
    --content-h2-mb: 0.75rem;
    --content-h3-mt: 1.25rem;
    --content-h3-mb: 0.75rem;
    --content-p-mb: 0.75rem;
    --content-img-my: 1rem;
  }

  /* 移动端表格优化 */
  .content-body th,
  .content-body td {
    @apply px-2 py-2 text-xs;
    width: 80px;
    height: 40px;
  }

  /* 移动端代码块优化 */
  .content-body pre {
    @apply my-4 p-3;
    overflow: hidden;
    max-width: 100%;
    font-size: 0.8em;
    transform: scale(0.9);
    transform-origin: left top;
  }
}

/* Tiptap 选中状态 */
.content-editor .ProseMirror-selectednode {
  @apply outline-2 outline-primary outline-offset-2;
}

/* 编辑器中的 details 样式 */
.content-editor details {
  @apply my-4 rounded-lg border border-border overflow-hidden;
  background-color: var(--content-quote-bg);
}

.content-editor details summary {
  @apply cursor-pointer px-4 py-3 font-medium transition-colors list-none;
}

.content-editor details summary::-webkit-details-marker {
  display: none;
}

.content-editor details summary::before {
  content: "▶";
  @apply inline-block mr-2 text-xs transition-transform duration-200;
}

.content-editor details[open] summary::before {
  transform: rotate(90deg);
}

.content-editor details summary:hover {
  @apply bg-muted/50;
}

.content-editor details[open] summary {
  @apply border-b border-border;
}

/* details 内容区域 */
.content-editor details > *:not(summary) {
  @apply px-4;
}

.content-editor details > *:not(summary):first-of-type {
  @apply pt-3;
}

.content-editor details > *:not(summary):last-child {
  @apply pb-3;
}

/* 折叠时隐藏内容 */
.content-editor details:not([open]) > *:not(summary) {
  @apply hidden;
}

/* 编辑器 details 内部列表样式 */
.content-editor details ul:not([data-type="taskList"]) {
  @apply list-disc pl-6 mb-4;
}

.content-editor details ol {
  @apply list-decimal pl-6 mb-4;
}

.content-editor details li {
  @apply mb-2 pl-1;
  line-height: 1.7;
}

/* 编辑器 details 内部嵌套列表 */
.content-editor details ul ul,
.content-editor details ol ul,
.content-editor details ul ol,
.content-editor details ol ol {
  @apply mt-2 mb-0;
}

/* 编辑器 details 内部任务列表 */
.content-editor details ul[data-type="taskList"] {
  @apply list-none pl-0 my-4;
}

.content-editor details ul[data-type="taskList"] li {
  display: flex;
  flex-direction: row;
  align-items: flex-start;
  gap: 0.5rem;
  margin-bottom: 0.5rem;
}

/* 编辑器 details 内部代码块 */
.content-editor details pre {
  @apply relative rounded-lg overflow-auto my-4 p-4 border bg-transparent;
}

/* 编辑器 details 内部引用 */
.content-editor details blockquote {
  @apply my-4 pl-4 py-3 rounded-r-lg border-l-4 not-italic;
  background-color: hsl(var(--muted) / 0.5);
  border-color: var(--content-primary);
  color: var(--muted-foreground);
}

/* 编辑器 details 内部标题 */
.content-editor details h1,
.content-editor details h2,
.content-editor details h3,
.content-editor details h4,
.content-editor details h5,
.content-editor details h6 {
  @apply mt-4 first:mt-0;
}

/* 编辑器 details 内部图片 */
.content-editor details img {
  @apply block mx-auto rounded-lg my-4 max-w-full h-auto border border-border;
}

/* 编辑器 details 内部分割线 */
.content-editor details hr {
  @apply my-4 border-none h-px;
  background-image: linear-gradient(
    to right,
    transparent,
    hsl(var(--border)),
    transparent
  );
}

/* ============================================
   文章展示特定样式
   ============================================ */
.content-article {
  /* 文章页面可以有更大的间距 */
}

/* ============================================
   主题变体: Default — 自然绿色，温暖清新
   适合：通用博客、技术文章
   排版风格：两端对齐、标准缩进、柔和装饰
   ============================================ */
.content-theme-default {
  --content-primary: #42b983;
  --content-quote-bg: rgba(66, 185, 131, 0.06);
}

.dark .content-theme-default {
  --content-primary: #5cd6a0;
  --content-quote-bg: rgba(92, 214, 160, 0.08);
}

/* Default: h3 左边框使用渐变 */
.content-theme-default h3 {
  border-image: linear-gradient(to bottom, #42b983, #2d8f63) 1;
}

.dark .content-theme-default h3 {
  border-image: linear-gradient(to bottom, #5cd6a0, #42b983) 1;
}

/* Default: 链接悬停效果 */
.content-theme-default a:hover {
  opacity: 1;
  border-bottom-width: 2px;
}

/* Default: 行内代码 */
.content-theme-default code:not(pre code) {
  color: #2d8f63;
  background-color: rgba(66, 185, 131, 0.08);
  border-color: rgba(66, 185, 131, 0.15);
}

.dark .content-theme-default code:not(pre code) {
  color: #5cd6a0;
  background-color: rgba(92, 214, 160, 0.1);
  border-color: rgba(92, 214, 160, 0.2);
}

/* Default: mark 绿底高亮 */
.content-theme-default mark {
  background-color: rgba(66, 185, 131, 0.2);
}

.dark .content-theme-default mark {
  background-color: rgba(92, 214, 160, 0.2);
}

/* Default: 嵌套列表标记保持默认 */

/* ============================================
   主题变体: Minimal — 纯粹黑白，克制内敛
   适合：摄影博客、个人随笔、设计类
   排版风格：左对齐、无装饰、大留白
   ============================================ */
.content-theme-minimal {
  --content-primary: hsl(var(--foreground));
  --content-quote-bg: transparent;
}

/* Minimal: 段落左对齐，不使用 justify */
.content-theme-minimal p {
  text-align: left;
}

/* Minimal: 标题使用轻量 font-weight + 紧字距 */
.content-theme-minimal h1 {
  @apply font-light;
  font-size: 2.25em;
  letter-spacing: -0.02em;
}

.content-theme-minimal h2 {
  @apply font-normal;
  font-size: 1.5em;
  letter-spacing: -0.01em;
}

/* Minimal: h3 大写间距 */
.content-theme-minimal h3 {
  @apply border-l-0 pl-0 uppercase;
  font-size: 0.875em;
  letter-spacing: 0.15em;
  font-weight: 500;
}

/* Minimal: 链接无装饰下划线，hover 时出现 */
.content-theme-minimal a {
  color: hsl(var(--foreground));
  border-bottom: none;
  transition: border-bottom-color 0.2s ease;
}

.content-theme-minimal a:hover {
  border-bottom: 1px solid hsl(var(--foreground));
  opacity: 1;
}

/* Minimal: 行内代码极简 */
.content-theme-minimal code:not(pre code) {
  color: hsl(var(--foreground));
  background-color: hsl(var(--muted) / 0.5);
  border: none;
}

.dark .content-theme-minimal code:not(pre code) {
  background-color: hsl(var(--muted) / 0.3);
}

/* Minimal: 列表保持默认样式 */
.content-theme-minimal li {
  color: hsl(var(--foreground) / 0.85);
}

/* Minimal: mark 灰色高亮 */
.content-theme-minimal mark {
  background-color: hsl(var(--muted));
}

.dark .content-theme-minimal mark {
  background-color: hsl(var(--muted) / 0.6);
}

/* Minimal: 代码块无边框无阴影 */
.content-theme-minimal pre {
  box-shadow: none;
  @apply border-none rounded-none;
}

/* Minimal: 图片无边框无阴影 */
.content-theme-minimal img {
  @apply border-0 rounded-none;
  box-shadow: none;
}

/* ============================================
   主题变体: Magazine — 经典杂志排版
   适合：长篇叙事、专栏文章、评论
   排版风格：两端对齐、衬线正文、首字下沉
   ============================================ */
.content-theme-magazine {
  --content-primary: #c0392b;
  --content-quote-bg: rgba(192, 57, 43, 0.04);
  --content-line-height: 1.9;
  @apply font-serif;
}

.dark .content-theme-magazine {
  --content-primary: #e74c3c;
  --content-quote-bg: rgba(231, 76, 60, 0.06);
}

/* Magazine: 段落两端对齐 + 间距 */
.content-theme-magazine p {
  text-align: justify;
  letter-spacing: 0.01em;
  hyphens: auto;
}

/* Magazine: 标题用 sans-serif 形成衬线/无衬线对比 */
.content-theme-magazine h1,
.content-theme-magazine h2,
.content-theme-magazine h3,
.content-theme-magazine h4 {
  @apply font-sans;
  letter-spacing: 0;
}

/* Magazine: h1 大标题居中 + 装饰线 */
.content-theme-magazine h1 {
  @apply text-center pb-4 mb-8;
  font-size: 2.25em;
  position: relative;
}

@media (min-width: 768px) {
  .content-theme-magazine h1 {
    font-size: 3em;
  }
}

.content-theme-magazine h1::after {
  content: "";
  display: block;
  width: 60px;
  height: 3px;
  background-color: var(--content-primary);
  margin: 1rem auto 0;
}

/* Magazine: h2 带左侧红色粗线 */
.content-theme-magazine h2 {
  @apply pl-4 border-l-4;
  border-color: var(--content-primary);
}

/* Magazine: h3 去除默认左边框，用下划线 */
.content-theme-magazine h3 {
  @apply border-l-0 pl-0 pb-2 border-b;
  border-color: hsl(var(--border));
}

/* Magazine: 首段首字下沉 */
.content-theme-magazine > p:first-of-type::first-letter,
.content-theme-magazine .content-article > p:first-of-type::first-letter {
  @apply text-5xl font-bold float-left mr-3 leading-none;
  color: var(--content-primary);
  font-family: Georgia, serif;
  padding-top: 4px;
}

/* Magazine: 行内代码 */
.content-theme-magazine code:not(pre code) {
  color: #8e2420;
  background-color: rgba(192, 57, 43, 0.06);
  border-color: rgba(192, 57, 43, 0.12);
  @apply font-mono;
}

.dark .content-theme-magazine code:not(pre code) {
  color: #f1948a;
  background-color: rgba(231, 76, 60, 0.1);
  border-color: rgba(231, 76, 60, 0.2);
}

/* Magazine: 嵌套列表保持默认样式 */
.content-theme-magazine a {
  color: var(--content-primary);
  border-bottom-color: var(--content-primary);
}

/* Magazine: mark 红色柔和高亮 */
.content-theme-magazine mark {
  background-color: rgba(192, 57, 43, 0.12);
}

.dark .content-theme-magazine mark {
  background-color: rgba(231, 76, 60, 0.15);
}

/* Magazine: 嵌套列表保持默认样式 */

/* ============================================
   主题变体: Notion — 紧凑工具风
   适合：技术文档、知识库、笔记
   排版风格：左对齐、紧凑、扁平化装饰
   ============================================ */
.content-theme-notion {
  --content-primary: #2383e2;
  --content-quote-bg: hsl(var(--muted) / 0.5);
  --content-line-height: 1.7;
  letter-spacing: 0;
}

.dark .content-theme-notion {
  --content-primary: #529cca;
  --content-quote-bg: hsl(var(--muted) / 0.3);
}

/* Notion: 段落左对齐、紧凑行高 */
.content-theme-notion p {
  text-align: left;
  letter-spacing: 0;
}

/* Notion: 标题紧凑，无装饰，字距 0 */
.content-theme-notion h1 {
  @apply font-bold;
  font-size: 2.25em;
  letter-spacing: 0;
}

.content-theme-notion h2 {
  @apply font-semibold;
  font-size: 1.5em;
  letter-spacing: 0;
}

.content-theme-notion h3 {
  @apply font-semibold border-l-0 pl-0;
  font-size: 1.25em;
  letter-spacing: 0;
}

/* Notion: 行内代码 — 经典红色 */
.content-theme-notion code:not(pre code) {
  color: #eb5757;
  background-color: rgba(235, 87, 87, 0.06);
  border: none;
  @apply rounded-sm px-1 py-0.5;
}

.dark .content-theme-notion code:not(pre code) {
  color: #ff6b6b;
  background-color: rgba(255, 107, 107, 0.1);
}

/* Notion: 链接蓝色下划线 */
.content-theme-notion a {
  color: var(--content-primary);
  border-bottom: none;
  text-decoration: underline;
  text-underline-offset: 3px;
  text-decoration-color: var(--content-primary);
}

.content-theme-notion a:hover {
  opacity: 0.8;
}

/* Notion: checkbox 蓝色 */
.content-theme-notion pre {
  box-shadow: none;
  @apply border-none;
  background-color: hsl(var(--muted) / 0.5);
}

.dark .content-theme-notion pre {
  background-color: hsl(var(--muted) / 0.3);
}

/* Notion: checkbox 蓝色 */
.content-theme-notion ul[data-type="taskList"] input[type="checkbox"] {
  accent-color: #2383e2;
}

.dark .content-theme-notion ul[data-type="taskList"] input[type="checkbox"] {
  accent-color: #529cca;
}

/* Notion: mark 黄色高亮（Notion 经典） */
.content-theme-notion mark {
  background-color: rgba(255, 212, 0, 0.4);
  @apply rounded-sm;
}

.dark .content-theme-notion mark {
  background-color: rgba(255, 212, 0, 0.2);
}

/* Notion: 图片无阴影 */
.content-theme-notion img {
  box-shadow: none;
}

/* ============================================
   主题变体: Japanese — 日式组版美学
   适合：散文、随笔、文学类内容
   排版风格：两端对齐、首行缩进、大行距、书籍感
   ============================================ */
.content-theme-japanese {
  --content-primary: #1a5fb4;
  --content-quote-bg: transparent;
  --content-line-height: 2;
  --content-p-mb: 1.25rem;
  --content-h1-mt: 2.5rem;
  --content-h1-mb: 2rem;
  --content-h2-mt: 2.5rem;
  --content-h2-mb: 1.5rem;
  --content-h3-mt: 2rem;
  --content-h3-mb: 1rem;

  letter-spacing: 0.04em;
}

.dark .content-theme-japanese {
  --content-primary: #5b9bd5;
}

/* Japanese: 段落首行缩进 + 两端对齐 */
.content-theme-japanese p {
  text-indent: 2em;
  text-align: justify;
}

/* Japanese: 列表/引用/代码内不缩进 */
.content-theme-japanese li > p,
.content-theme-japanese blockquote p,
.content-theme-japanese pre + p {
  text-indent: 0;
}

/* Japanese: h1 居中 + 底部细线 */
.content-theme-japanese h1 {
  @apply text-center pb-6 font-normal;
  letter-spacing: 0.1em;
  position: relative;
}

.content-theme-japanese h1::after {
  content: "";
  display: block;
  width: 40px;
  height: 2px;
  background-color: var(--content-primary);
  margin: 1.5rem auto 0;
}

/* Japanese: h2 轻字重 + 底部边框 */
.content-theme-japanese h2 {
  @apply font-normal pb-3;
  letter-spacing: 0.08em;
  border-bottom: 1px solid hsl(var(--border));
}

/* Japanese: h3 无左边框，更轻的字重 */
.content-theme-japanese h3 {
  @apply border-l-0 pl-0 font-medium;
  letter-spacing: 0.06em;
}

/* Japanese: 链接 — 蓝色，无边框 */
.content-theme-japanese a {
  color: var(--content-primary);
  border-bottom: none;
  text-decoration: none;
}

.content-theme-japanese a:hover {
  text-decoration: underline;
  text-underline-offset: 4px;
  opacity: 1;
}

/* Japanese: 行内代码 */
.content-theme-japanese code:not(pre code) {
  color: #1a5fb4;
  background-color: rgba(26, 95, 180, 0.05);
  border-color: rgba(26, 95, 180, 0.1);
}

.dark .content-theme-japanese code:not(pre code) {
  color: #5b9bd5;
  background-color: rgba(91, 155, 213, 0.1);
  border-color: rgba(91, 155, 213, 0.15);
}

/* Japanese: 更大的列表间距 */
.content-theme-japanese ul,
.content-theme-japanese ol {
  @apply mb-6;
}

.content-theme-japanese li {
  @apply mb-3;
}

/* Japanese: 代码块柔和 */
.content-theme-japanese pre {
  box-shadow: none;
  @apply rounded-sm;
}

/* Japanese: 图片无边框，更柔和的阴影 */
.content-theme-japanese img {
  @apply border-0;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.06);
}

/* Japanese: mark 淡蓝底 */
.content-theme-japanese mark {
  background-color: rgba(26, 95, 180, 0.12);
}

.dark .content-theme-japanese mark {
  background-color: rgba(91, 155, 213, 0.15);
}

/* ============================================
   行高变体（置于主题之后，级联覆盖主题默认值）
   ============================================ */
.content-leading-tight {
  --content-line-height: 1.4;
}

.content-leading-normal {
  --content-line-height: 1.6;
}

.content-leading-relaxed {
  --content-line-height: 1.75;
}

.content-leading-loose {
  --content-line-height: 2;
}

/* ============================================
   间距变体（置于主题之后，级联覆盖主题默认值）
   ============================================ */
.content-spacing-tight {
  --content-p-mb: 0.25rem;
  --content-h1-mt: 1rem;
  --content-h1-mb: 0.5rem;
  --content-h2-mt: 0.75rem;
  --content-h2-mb: 0.375rem;
  --content-h3-mt: 0.5rem;
  --content-h3-mb: 0.25rem;
  --content-img-my: 0.5rem;
}

.content-spacing-compact {
  --content-p-mb: 0.5rem;
  --content-h1-mt: 1.5rem;
  --content-h1-mb: 0.75rem;
  --content-h2-mt: 1.25rem;
  --content-h2-mb: 0.5rem;
  --content-h3-mt: 1rem;
  --content-h3-mb: 0.375rem;
  --content-img-my: 0.75rem;
}

.content-spacing-normal {
  --content-p-mb: 1rem;
  --content-h1-mt: 2.5rem;
  --content-h1-mb: 1rem;
  --content-h2-mt: 2rem;
  --content-h2-mb: 0.75rem;
  --content-h3-mt: 1.5rem;
  --content-h3-mb: 0.5rem;
  --content-img-my: 1.25rem;
}

.content-spacing-loose {
  --content-p-mb: 1.5rem;
  --content-h1-mt: 3.5rem;
  --content-h1-mb: 1.5rem;
  --content-h2-mt: 2.5rem;
  --content-h2-mb: 1.25rem;
  --content-h3-mt: 2rem;
  --content-h3-mb: 1rem;
  --content-img-my: 2rem;
}

/* ============================================
   高亮动画 (脚注跳转)
   ============================================ */
.content-body .highlight-target {
  @apply bg-primary/10 rounded px-2 py-1;
  animation: content-highlight-pulse 2s ease-in-out;
}

@keyframes content-highlight-pulse {
  0%,
  100% {
    background-color: transparent;
  }

  25%,
  75% {
    background-color: hsl(var(--primary) / 0.15);
  }

  50% {
    background-color: hsl(var(--primary) / 0.25);
  }
}

/* ============================================
   摘要内容样式
   ============================================ */
.excerpt-content {
  font-size: 12px !important;
  line-height: 1.5 !important;
}

.excerpt-content .tiptap,
.excerpt-content .ProseMirror,
.excerpt-text.tiptap,
.excerpt-text.ProseMirror {
  padding: 0 !important;
  min-height: auto !important;
  font-size: 12px !important;
  line-height: 1.5 !important;
}

.excerpt-content .tiptap p,
.excerpt-content .ProseMirror p,
.excerpt-text.tiptap p,
.excerpt-text.ProseMirror p {
  margin: 0 !important;
  margin-bottom: 0 !important;
  font-size: 12px !important;
  line-height: 1.5 !important;
}

/* 覆盖 content-body 的默认样式 */
.excerpt-content .content-body,
.excerpt-text.content-body {
  font-size: 12px !important;
  line-height: 1.5 !important;
}

.excerpt-content .content-body p,
.excerpt-text.content-body p {
  margin: 0 !important;
  margin-bottom: 0 !important;
  font-size: 12px !important;
  line-height: 1.5 !important;
}

/* ============================================
   Lowlight/Highlight.js 代码高亮
   ============================================ */
/* Highlight.js 语法高亮 - 亮色主题 (GitHub Light) */
.hljs {
  color: #24292f;
  background: transparent;
}

.hljs-comment,
.hljs-quote {
  color: #6e7781;
  font-style: italic;
}

.hljs-keyword,
.hljs-selector-tag,
.hljs-addition {
  color: #cf222e;
}

.hljs-number,
.hljs-string,
.hljs-meta .hljs-meta-string,
.hljs-literal,
.hljs-doctag,
.hljs-regexp {
  color: #0a3069;
}

.hljs-title,
.hljs-section,
.hljs-name,
.hljs-selector-id,
.hljs-selector-class {
  color: #8250df;
}

.hljs-attribute,
.hljs-attr,
.hljs-variable,
.hljs-template-variable,
.hljs-class .hljs-title,
.hljs-type {
  color: #953800;
}

.hljs-symbol,
.hljs-bullet,
.hljs-subst,
.hljs-meta,
.hljs-meta .hljs-keyword,
.hljs-selector-attr,
.hljs-selector-pseudo,
.hljs-link {
  color: #0550ae;
}

.hljs-built_in,
.hljs-deletion {
  color: #cf222e;
}

.hljs-emphasis {
  font-style: italic;
}

.hljs-strong {
  font-weight: bold;
}

/* Highlight.js 语法高亮 - 暗色主题 (GitHub Dark) */
.dark .hljs {
  color: #c9d1d9;
  background: transparent;
}

.dark .hljs-comment,
.dark .hljs-quote {
  color: #8b949e;
  font-style: italic;
}

.dark .hljs-keyword,
.dark .hljs-selector-tag,
.dark .hljs-addition {
  color: #ff7b72;
}

.dark .hljs-number,
.dark .hljs-string,
.dark .hljs-meta .hljs-meta-string,
.dark .hljs-literal,
.dark .hljs-doctag,
.dark .hljs-regexp {
  color: #a5d6ff;
}

.dark .hljs-title,
.dark .hljs-section,
.dark .hljs-name,
.dark .hljs-selector-id,
.dark .hljs-selector-class {
  color: #d2a8ff;
}

.dark .hljs-attribute,
.dark .hljs-attr,
.dark .hljs-variable,
.dark .hljs-template-variable,
.dark .hljs-class .hljs-title,
.dark .hljs-type {
  color: #ffa657;
}

.dark .hljs-symbol,
.dark .hljs-bullet,
.dark .hljs-subst,
.dark .hljs-meta,
.dark .hljs-meta .hljs-keyword,
.dark .hljs-selector-attr,
.dark .hljs-selector-pseudo,
.dark .hljs-link {
  color: #79c0ff;
}

.dark .hljs-built_in,
.dark .hljs-deletion {
  color: #ffa198;
}

/* ============================================
   CodeBlockLowlight 代码块样式
   ============================================ */
/* 代码块基础样式 */
.content-body pre,
.content-editor pre {
  @apply relative rounded-lg overflow-auto my-5 p-4 border;
  background-color: #f6f8fa;
}

.dark .content-body pre,
.dark .content-editor pre {
  background-color: #0d1117;
}

.content-body pre code,
.content-editor pre code {
  @apply block overflow-x-auto text-sm font-mono leading-relaxed;
  background: transparent;
  color: inherit;
}
